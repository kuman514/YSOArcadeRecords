# YSOArcadeRecords
- 본인 YSO(kuman514)가 기록한 각종 고전 아케이드 게임 관련 기록을 열람할 수 있는 앱.
- [YSOShmupRecords](https://github.com/kuman514/YSOShmupRecords)가 이 프로젝트의 전신입니다.
- [앱 방문하기](https://yso-arcade-records.vercel.app/)

## 프로젝트를 만든 목적
- YSOShmupRecords에서 계승됨
  - 슈팅게임 동호인들과 더욱 원활하게 교류하기 위해 제작되었습니다.
  - 기존에는 SNS나 디스코드 등의 메신저로 교류하였으나, 이는 다른 종류의 글과 메시지까지 난잡하게 섞여 있어 슈팅게임 기록을 제대로 찾아보기 어려운 문제를 안고 있습니다.
  - 이러한 문제를 해결하고자 제가 달성한 각종 기록을 더욱 쉽게 열람하고 공유할 수 있는 사이트를 직접 개발하였습니다.
- Next.js를 사용하여 기존 YSOShmupRecords의 단점 개선
  - 레포지토리가 분산되어 있던 프론트엔드(YSOShmupRecords), 백엔드(YSOShmupRecordsBackend), 백오피스(Writronics)를 하나의 레포지토리(YSOArcadeRecords)에 통합하고자 합니다.
  - 라우팅 설정에 추가적인 작업이 필요한 react-router-dom으로부터 탈피하고, 파일 경로만 정해줘도 라우팅 설정이 끝나게끔 만들고 싶습니다. 즉, 더 쉬운 라우팅 방식을 사용하고자 합니다.
  - 서버 사이드 렌더링을 통해 페이지의 초기 로딩 시간을 감소시키고자 합니다.

## 개발 환경
- Windows 11 또는 MacOS 15에서 개발
- Visual Studio Code 사용
- yarn berry 대신 npm 사용
  - 사유: Next.js 15의 Turbopack에서 yarn berry의 Plug'n Play를 사용하지 못함.
    - 근거: [Turbopack Unsupported Features](https://nextjs.org/docs/app/api-reference/turbopack#unsupported-features)의 Yarn PnP 항목에, `We are currently not planning to support Yarn PnP in Next.js with Turbopack. (저희는 현재 Next.js Turbopack에 대한 Yarn PnP를 지원할 계획이 없습니다.)`라고 적혀 있다.

## 태스크 브레이크다운
- ~~YSOArcadeRecords MVP 완성하기~~ (완료)
  - ~~YSOShmupRecords로부터 승계되는 페이지~~ (완료)
    - ~~대문 페이지~~ (완료)
      - ~~대문용 로고~~ (완료)
      - ~~대문용 링크~~ (완료)
      - ~~이 곳은 뭐하는 곳인가~~ (완료)
      - ~~YSO(kuman514)는 누구인가~~ (완료)
      - ~~통산 최고 성과는 무엇인가~~ (완료)
    - ~~기록 목록 페이지~~ (완료)
    - ~~기록 상세 페이지~~ (완료)
  - ~~신규 추가 페이지~~ (완료)
    - ~~기록 쓰기 페이지~~ (완료)
  - ~~YSOShmupRecords로부터 승계되는 컴포넌트~~ (완료)
    - ~~페이지 헤더~~ (완료)
      - ~~메인 헤더~~ (완료)
      - ~~스크롤 시 보일 대체 헤더~~ (완료)
      - ~~사이드바~~ (완료)
    - ~~게시물 목록 아이템~~ (완료)
    - ~~비순서형 리스트~~ (완료)
    - ~~모달~~ (완료)
      - ~~모달 콘텐츠 오버레이~~ (완료)
      - ~~클릭 에리어~~ (완료)
    - ~~이미지 컨트롤러~~ (완료)
      - ~~이미지 줌 컨트롤러~~ (완료)
      - ~~이전/다음 이미지 컨트롤러~~ (완료)
    - ~~스켈레톤 컴포넌트~~ (완료)
    - ~~포스트 목록 아이템~~ (완료)
    - ~~기록 상세 포스트~~ (완료)
  - ~~신규 추가 컴포넌트~~ (완료)
    - ~~포스트 폼~~ (완료)
      - ~~아케이드 기록 포스트 폼~~ (완료)
  - ~~그 외~~ (완료)
    - ~~아케이드 기록 구성 요소 타입 정의~~ (완료)
    - ~~데이터베이스 및 파일 스토리지 정하기~~ (완료) -> Supabase를 사용하기로 결정
      - ~~조건~~
        - ~~되도록 상시 무료로 이용할 수 있어야 한다.~~
          - ~~자금의 상황에 따라 이 조건을 다소 어길 수 있다.~~
        - ~~SQL을 사용한 데이터베이스 열람 및 조작이 가능해야 한다.~~
          - ~~SQL Injection을 방지하기 위해, Object Related Mapping을 사용할 수도 있다.~~
        - ~~로그인 세션의 경우, Lucia와 연동이 가능해야 한다.~~
          - ~~Lucia는 올해 초에 퇴역하였으며, 세션 구현 학습용으로만 운영된다고 한다. (근거: https://github.com/lucia-auth/lucia/discussions/1707)~~
          - ~~로그인 세션을 구현할 다른 방법을 찾아보는 중.~~
      - ~~임시 조치~~
        - ~~확실히 정해질 때까지 임시 로컬 DB로 `better-sqlite3` 사용.~~
        - ~~확실히 정해질 경우, `better-sqlite3`와 `lucia-auth`를 버린다.~~
    - ~~포스트 구성 요소 타입 정의~~ (완료)
    - ~~아케이드 정보 타입 정의~~ (완료)
    - ~~플레이 수단 타입 정의~~ (완료)
    - ~~Supabase 기능 구축~~ (완료)
      - ~~이 링크에 있는 절차를 따름: https://supabase.com/docs/guides/auth/server-side/nextjs~~ (완료)
      - ~~데이터베이스 구축~~ (완료)
        - ~~아케이드 기록 데이터베이스 구축~~ (완료)
        - ~~아케이드 정보 데이터베이스 구축~~ (완료)
        - ~~플레이 수단 데이터베이스 구축~~ (완료)
      - ~~관리자 로그인 기능 구축~~ (완료)
      - ~~아케이드 기록 테스트~~ (완료)
        - ~~기록 생성 및 테스트~~ (완료)
        - ~~기록 수정 및 삭제 테스트~~ (완료)
  - ~~Vercel을 통해 배포하기~~ (완료)
- YSOArcadeRecords MVP 이후 추가 기능 완성하기
  - 통산 최고 성과에 기록 링크 걸기
  - ~~신규 추가 페이지~~ (완료)
    - ~~리뷰 목록 페이지~~ (완료)
    - ~~리뷰 아티클 페이지~~ (완료)
    - ~~리뷰 쓰기 페이지~~ (완료)
    - ~~갤러리 목록 페이지~~ (완료)
    - ~~갤러리 페이지~~ (완료)
    - ~~갤러리 쓰기 페이지~~ (완료)
  - ~~신규 추가 컴포넌트~~ (완료)
    - ~~포스트~~ (완료)
      - ~~리뷰 포스트~~ (완료)
      - ~~갤러리 포스트~~ (완료)
    - ~~포스트 폼~~ (완료)
      - ~~리뷰 포스트 폼~~ (완료)
      - ~~갤러리 포스트 폼~~ (완료)
  - ~~리뷰 구성 요소 타입 정의~~ (완료)
  - ~~갤러리 구성 요소 타입 정의~~ (완료)
  - ~~Supabase 기능 연계~~ (완료)
    - ~~데이터베이스 구축~~ (완료)
      - ~~리뷰 데이터베이스 구축 및 테스트~~ (완료)
      - ~~갤러리 데이터베이스 구축 및 테스트~~ (완료)
  - 아케이드 기록 폼 간소화
    - 불필요한 애트리뷰트 삭제 또는 변경
      - ~~시간은 시간 애트리뷰트로, 점수는 점수 애트리뷰트로 분리~~ (완료)
        - 그래도 시간/점수 통합 애트리뷰트는 당분간 남겨놔야 할 듯?
        - 그렇다면, 통합 체계는 당분간 남겨놓고 수정이나 신규 시 분리된 시간/점수 인풋만 이용하여 입력할 수 있도록 만들기
      - ~~항상 1인 플레이를 가정하고 있기 때문에, 플레이어 수와 플레이 사이드 삭제~~ (완료)
    - ~~너무 긴 인풋들끼리 한 행에 합치기~~ (완료)
    - ~~기존 썸네일과 신규 등록 썸네일 한 행에 합치기~~ (완료)
    - 기존 이미지와 신규 등록 이미지 한 행에 합치기
  - 리뷰 폼 간소화
    - 불필요한 애트리뷰트 삭제 또는 변경
      - 특징, 기대사항, 첫인상, 장점, 단점, 결론 통합
    - 너무 긴 인풋들끼리 한 행에 합치기
    - 기존 썸네일과 신규 등록 썸네일 한 행에 합치기
    - 기존 이미지와 신규 등록 이미지 한 행에 합치기

## 트러블슈팅 목록
- Next Image에 fill 속성을 부여했는데 이미지가 페이지를 전부 다 덮는 문제.
  - Next Image 컴포넌트에 fill 속성을 부여할 때, style에 `position:absolute; height:100%; width:100%; left:0; top:0; right:0; bottom:0; color:transparent;` 값이 적용되기 때문이다.
  - 이를 해결하려면, 부모 컴포넌트의 style에 `position: relative`를 부여하자.
- Dynamic path를 위해 페이지 컴포넌트에 Path Parameters를 Props(`params`)로 추가했을 때 await하라는 문제.
  - `params should be awaited before using its properties.` 같은 에러가 발생한다.
  - `params`와 `searchParams`는 Dynamic API 중 일부로, 페이지나 레이아웃, 메타데이터 API, 라우트 핸들러에 제공되는데, Next.js 15에서 Dynamic API를 비동기적으로 만들었기 때문이라고 한다.
    - `params`와 `searchParams` 외에도, `next/headers` 패키지에 있는 `cookies()`, `draftMode()`, `headers()` 또한 Dynamic API라고 한다.
  - 이를 해결하려면, 페이지 컴포넌트의 Props 중 `params`와 `searchParams`를 `Promise<{ 기존 파라미터 타입 }>` 타입으로 바꿔준 뒤, 각 `params`와 `searchParams`를 await하여 받아오는 로직을 함수 내용에 추가한다.
    - 물론, Promise 객체를 await하는 내용을 추가하려면, 해당 페이지 컴포넌트를 async function으로 선언해야 한다.
  - 근거
    - https://nextjs.org/docs/messages/sync-dynamic-apis
    - https://nextjs.org/docs/messages/sync-dynamic-apis#possible-ways-to-fix-it
- 계속된 렌더 트리 불일치 에러
  - `npm run build`에서 자꾸 `Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: object.` 같은게 뜨거나, `npm run build`가 성공하더라도 `npm run start`로 실행된 환경에서 [Minified React Error #130](https://react.dev/errors/130?args%5B%5D=object&args%5B%5D=)이 나오는 현상이 발생.
    - 어떤 곳이든 전부 클라이언트 컴포넌트로 만들거나, 앱이 전역 상태를 사용하도록 구조를 변경해도, 동일한 현상이 발생한다.
  - SVG가 사용된 부분을 모두 제거했더니 `npm run build`는 물론 `npm run start` 환경에서까지 잘 작동한다.
  - 그래서 원인이 무엇이었나?
    - 당시 SVG를 컴포넌트로 변경하기 위해 사용한 패키지가 `svgr-webpack`이었다.
      - `next/image`에 SVG를 넣는 것보단 `svgr-webpack`을 사용하여 컴포넌트화 시키는 것이 `fill`이나 `stroke`같은 더욱 유연한 스타일링을 적용할 수 있었기에 설치 후 설정했었다.
      - 확인해보니, `svgr-webpack`으로 전환된 SVG 컴포넌트들은 클라이언트 컴포넌트.
      - `svgr-webpack`으로 전환된 SVG 컴포넌트를 제거하고 그 자리에 임시 텍스트를 넣으니, 빌드 환경에서의 동작까지 전부 에러 없이 진행되었다.
    - 프로젝트 내에서의 SVG 또한, `fill`이나 `stroke`같은 스타일링을 각각 한 가지만 사용한지라, 유연한 스타일링이 필요하지 않을 것이라 판단, `svgr-webpack`을 제거하고 `next/image`에 SVG를 넣는 방법으로 회귀하였다.
  - 현재는 새로운 설정을 적용하고 다시 `svgr-webpack`을 복구했다.
- 이미지를 여러 개 첨부한 기록을 등록할 때 client side exception이 발생하는 현상
  - 현재 프로젝트는 Vercel에 배포한 상태이며, 여기서 에러 코드 413이 발생한다.
  - Vercel에 배포된 함수가 받아들이는 payload의 사이즈는 4.5mb를 넘지 않는다고 한다.
    - 근거: https://vercel.com/docs/errors/FUNCTION_PAYLOAD_TOO_LARGE#troubleshoot
  - 이에 따라, 이미지와 데이터를 하나의 payload에 함께 올리는 것이 아닌, 이미지를 개별로 따로 올리고 그 다음에 본 데이터를 제출하는 전략을 취하는 것이 좋겠다.
    - 현재 이미지 개별 업로드와 아케이드 기록 추가/수정은 Route Handler를 사용하고 있다.

## 버그 목록
- ~~기록에 태그가 없을 때 태그 영역에 검은 사각형 모양 점이 나타나는 현상~~ `v1.0.1에 배포됨`
- ~~이미지를 여러 개 첨부한 기록을 등록할 때 client side exception이 발생하는 현상 (응답 코드 `413`)~~ `v1.0.1에 배포됨`

## 받은 피드백
- ~~인트로 페이지를 방문했을 때, 최근 게시글이 보였으면 좋겠다.~~ `1.2.0에 배포됨`
- ~~사이드바에서 기록 부문을 살펴볼 때, 주력 이외의 등록된 부문을 보기 힘들다.~~ `1.2.0에 배포됨`
- 레이아웃이 너무 노션스럽다. 조금 더 블로그다운 디자인이 되었으면 좋겠다.
- 아케이드 기록 폼과 리뷰 폼이 갤러리 폼에 비해 너무 길다. 최대한 한 페이지에 들어오게끔 만들 수 있나?

## 버전
- `v1.0.0` (2025년 3월 14일)
  - 최초 릴리즈
- `v1.0.1` (2025년 3월 19일)
  - 이미지를 포함한 (아케이드 기록 등의) 포스트 업로드 시 client side exception이 발생하는 현상 수정
  - 아케이드 기록 등 포스트 등록 시 태그를 입력하지 않았을 경우 태그 영역에 검은 사각형 모양 점이 나타나는 현상 수정
- `v1.0.2` (2025년 3월 26일)
  - 보안을 위해 Next.js 패키지 업그레이드
  - 존재하지 않는 아케이드 기록 목록을 보려할 때 client side exception이 발생하는 현상 수정
  - 프로덕션 버전과 개발용 버전을 구분지음
  - 아케이드 기록 아티클 페이지의 썸네일과 요약 부분의 간격을 소폭 늘림
  - 아케이드 기록 아티클 페이지에서 원본 이미지 모달을 표시할 수 있는 방법을 썸네일 부분에 추가
  - 이미지 로딩 성능 향상
  - 파비콘(favicon) 추가
- `v1.0.3` (2025년 3월 30일)
  - 아케이드 기록 등록/수정 중 문제 발생 시 제출 버튼의 잠금이 풀리지 않던 문제 수정
- `v1.1.0` (2025년 4월 8일)
  - 리뷰 기능 추가
  - 모바일 페이지 이미지 뷰어 모달에서 이미지를 확대하거나 이동했을 때 페이지가 함께 스크롤되는 문제 수정
- `v1.1.1` (2025년 4월 20일)
  - 로그인 화면의 로그인 버튼, 기록/리뷰 아티클 화면의 삭제 버튼, 로그아웃 버튼 등등이 해당 프로세스 진행 중에는 클릭이 불가능하도록 만듦
  - 드래그 앤 드롭으로 사진 순서를 옮기는 기능 추가
- `v1.1.2` (2025년 5월 15일)
  - 각종 포스트 리스트 화면에서 포스트 아이템 호버 시 유튜브 로고까지 동시에 확대되던 문제 수정
- `v1.1.3` (2025년 5월 15일)
  - <핫픽스> 각종 포스트 리스트 화면에서 포스트 아이템에 검은 그레디언트가 안 나오던 문제 수정
- `v1.1.4` (2025년 5월 22일)
  - 다크 모드에서 텍스트, 드롭다운, 날짜 인풋의 배경이 제대로 들어가지 않던 문제 수정
- `v1.2.0` (2025년 6월 25일)
  - 최근 포스트 (아케이드 기록, 리뷰) 목록이 홈 화면에 표시하는 기능 추가
  - 리뷰 포스트 작성 조건이 변경됨
  - 기록이 하나라도 등록된 부문만 사이드바의 아케이드 게임 기록 링크트리에 표시
- `v1.2.1` (2025년 6월 25일)
  - <핫픽스> 최근 리뷰 목록 헤더의 불필요한 하단 마진 제거
- `v1.2.2` (2025년 7월 4일)
  - 사이드바를 열 때마다 아케이드 기록 부분의 링크트리가 깜빡이듯이 등장하던 문제 수정
  - 사이트 서체를 경기천년제목으로 변경
- `v1.2.3` (2025년 7월 27일)
  - 아케이드 기록이나 리뷰가 생성/수정/삭제되었을 때 필요한 경로만 캐시 재검증
  - 아케이드 기록에 비고가 없을 때 아케이드 기록 목록에 "메모 없음"이라고 표시되던 문제 수정
  - 갤러그 어레인지 개인 최고기록 갱신에 따라, 인트로 페이지의 개인 통산 최고 성과의 내용을 갱신
  - 데이터베이스로부터 아케이드 기록/리뷰 포스트 목록을 불러올 때 필요한 속성만 고름으로써 로딩 속도 향상
- `v1.2.4` (2025년 8월 5일)
  - 이미지 뷰어에 이미지가 1개뿐일 경우 이전 이미지/다음 이미지 버튼이 표시되지 않음
  - 이미지 뷰어의 하단에 현재 이미지 번호와 총 이미지 수 표시
  - 문의하기 버튼을 우하단에 표시
- `v1.2.5` (2025년 8월 10일)
  - 아케이드 기록 작성/수정 시 점수/시간 칸을 아예 비워놓아도 등록 시도가 되던 문제 수정
    - 물론 비워놓은 상태로 제출 시 오류로 인해 거절당함
  - 개인 통산 최고 성과, 아케이드 기록의 요약, 리뷰의 각 항목 등등에 쓰인 리스트 아이템의 마커가 보이지 않던 문제 수정
  - 아케이드 기록 목록과 리뷰 목록이 초기엔 10개, 더보기 버튼으로 5개씩 추가적으로 불러오도록 수정
- `v1.2.6` (2025년 8월 24일)
  - 메뉴 열기, 닫기, 이전/다음 이미지, 별점 등등의 아이콘이 잠시 비어있는 상태가 아닌 바로 표시하도록 만듦
  - 전체 아케이드 기록 수를 표시
- `v1.3.0` (2025년 8월 30일)
  - 갤러리 기능 추가
- `v1.3.1` (2025년 8월 30일)
  - <핫픽스> 갤러리 사진 뷰어에서 수정하기/삭제하기 버튼이 클릭되지 않는 문제 수정
- `v1.3.2` (2025년 8월 31일)
  - 새로운 갤러리 포스트에 대해, 등록된 최신 순서대로 정렬되어 표시됨을 보장
- `v1.3.3` (2025년 9월 2일)
  - 링크 복사 또는 포스트 생성/수정 시 알림을 토스트 방식으로 변경
